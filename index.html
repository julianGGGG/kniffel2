<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kniffel Score Sheet</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 5px;
            margin: 0;
            box-sizing: border-box;
            font-size: 0.9em;
            overflow: hidden; /* Verhindert das Scrollen */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #000;
            text-align: center;
            padding: 2px;
            width: 33.33%;
        }
        .category {
            text-align: left;
            font-size: 0.9em;
            text-transform: capitalize;
        }
        input[type=number], select, input[type=text], input[type=checkbox] {
            box-sizing: border-box;
            font-size: 0.9em;
        }
        select {
            text-align: center;
            text-align-last: center; /* For Firefox */
        }
        .result {
            font-weight: bold;
            text-align: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 20px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: #2196F3;
        }
        input:checked + .slider:before {
            transform: translateX(14px);
        }
        .slider.round {
            border-radius: 34px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        @media (max-width: 600px) {
            table, thead, tbody, th, td, tr {
                display: block;
            }
            thead tr {
                display: none;
            }
            tr {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                margin-bottom: 0;
                border: 1px solid #000;
                padding: 2px;
                background-color: #f9f9f9;
            }
            td {
                border: none;
                flex: 1;
                padding: 2px;
                text-align: left;
            }
            .category {
                flex: 1;
                font-weight: bold;
            }
            .checkbox-wrapper {
                display: flex;
                align-items: center;
                flex: 1;
            }
            select, input[type=number] {
                flex: 1;
            }
            .result, input[type=text] {
                text-align: center;
                font-weight: bold;
            }
        }
    </style>
</head>
<body>
    <table id="score-table">
        <tbody>
            <tr>
                <td>
                    <select id="player-count" style="width: 100%; box-sizing: border-box;">
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </td>
                <td id="player1-name-cell">
                    <div class="checkbox-wrapper">
                        <input type="text" id="player1-name" value="Spieler 1" class="result" style="width: 100%; box-sizing: border-box;">
                    </div>
                </td>
                <td id="player2-name-cell">
                    <div class="checkbox-wrapper">
                        <input type="text" id="player2-name" value="Spieler 2" class="result" style="width: 100%; box-sizing: border-box;">
                    </div>
                </td>
            </tr>
            <!-- The rest of the table rows will be dynamically generated based on the player count -->
        </tbody>
    </table>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const playerCountInput = document.getElementById('player-count');
            const table = document.getElementById('score-table');

            function createPlayerColumn(playerNumber) {
                return `
                    <td id="player${playerNumber}-name-cell">
                        <div class="checkbox-wrapper">
                            <input type="text" id="player${playerNumber}-name" value="Spieler ${playerNumber}" class="result" style="width: 100%; box-sizing: border-box;">
                        </div>
                    </td>`;
            }

            function updateTable() {
                const playerCount = parseInt(playerCountInput.value, 10);
                const headerRow = table.rows[0];
                
                // Remove all player columns
                while (headerRow.cells.length > 1) {
                    headerRow.deleteCell(1);
                }
                
                // Add the required number of player columns
                for (let i = 1; i <= playerCount; i++) {
                    headerRow.insertAdjacentHTML('beforeend', createPlayerColumn(i));
                }

                // Adjust table width for mobile view
                if (playerCount > 4) {
                    table.style.width = 'auto';
                } else {
                    table.style.width = '100%';
                }

                // Re-generate all other rows (except header)
                const categories = [
                    '1er', '2er', '3er', '4er', '5er', '6er',
                    'dreierpasch', 'viererpasch', 'fullhouse', 'kleinestr', 
                    'grossestr', 'kniffel', 'chance'
                ];
                
                // Clear existing rows
                while (table.rows.length > 1) {
                    table.deleteRow(1);
                }

                // Add rows for each category
                categories.forEach(category => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td class="category">${category}</td>`;
                    for (let i = 1; i <= playerCount; i++) {
                        row.insertAdjacentHTML('beforeend', `
                            <td>
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="player${i}-${category}-hide">
                                    <select id="player${i}-${category}">
                                        <option value="0">0</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                    </select>
                                </div>
                            </td>
                        `);
                    }
                    table.tBodies[0].appendChild(row);
                });

                // Add the total, bonus, and other summary rows
                const summaryRows = [
                    'Gesamt', 'Bonus', 'Gesamt Oben', 'Gesamt Unten', 'Gesamt Oben', 'Endsumme'
                ];
                summaryRows.forEach(row => {
                    const summaryRow = document.createElement('tr');
                    summaryRow.innerHTML = `<td class="category">${row}</td>`;
                    for (let i = 1; i <= playerCount; i++) {
                        summaryRow.insertAdjacentHTML('beforeend', `<td class="result"><span id="player${i}-${row.toLowerCase().replace(' ', '-')}">0</span></td>`);
                    }
                    table.tBodies[0].appendChild(summaryRow);
                });

                calculateTotals();
            }

            // Function to toggle visibility of elements and exclude from calculation
            function toggleVisibilityAndCalculation(checkbox, element) {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        element.style.display = 'none';
                        element.dataset.ignore = 'true';
                    } else {
                        element.style.display = 'block';
                        element.dataset.ignore = 'false';
                    }
                    calculateTotals();
                });
            }

            // Function to calculate totals
            function calculateTotals() {
                const playerCount = parseInt(playerCountInput.value, 10);
                const players = Array.from({ length: playerCount }, (_, i) => `player${i + 1}`);
                const upperCategories = ['1er', '2er', '3er', '4er', '5er', '6er'];
                const lowerCategories = ['dreierpasch', 'viererpasch', 'fullhouse', 'kleinestr', 'grossestr', 'kniffel', 'chance'];
                const upperSectionBonus = 63;
                const upperSectionBonusPoints = 35;

                players.forEach(player => {
                    let upperTotal = 0;
                    let lowerTotal = 0;

                    // Calculate upper section total
                    upperCategories.forEach(category => {
                        const element = document.getElementById(`${player}-${category}`);
                        if (element.dataset.ignore !== 'true') {
                            upperTotal += Number(element.value) || 0;
                        }
                    });

                    // Calculate bonus
                    let bonus = upperTotal >= upperSectionBonus ? upperSectionBonusPoints : 0;
                    document.getElementById(`${player}-bonus`).textContent = bonus;
                    document.getElementById(`${player}-gesamt-oben`).textContent = upperTotal + bonus;

                    // Calculate lower section total
                    lowerCategories.forEach(category => {
                        const element = document.getElementById(`${player}-${category}`);
                        if (element && element.dataset.ignore !== 'true') {
                            if (category === 'fullhouse' || category === 'kleinestr' || category === 'grossestr' || category === 'kniffel') {
                                lowerTotal += element.checked ? Number(element.value) : 0;
                            } else {
                                lowerTotal += Number(element.value) || 0;
                            }
                        }
                    });

                    // Set totals
                    document.getElementById(`${player}-gesamt`).textContent = upperTotal;
                    document.getElementById(`${player}-gesamt-unten`).textContent = lowerTotal;
                    document.getElementById(`${player}-gesamt-oben-2`).textContent = upperTotal + bonus;
                    document.getElementById(`${player}-endsumme`).textContent = upperTotal + bonus + lowerTotal;
                });
            }

            playerCountInput.addEventListener('change', updateTable);
            updateTable();
        });
    </script>
</body>
</html>
